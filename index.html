<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>NeuroSphere</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex">
  <!-- Сайдбар с историей -->
  <div class="w-64 bg-gray-900 text-white p-4">
    <h1 class="text-xl font-bold mb-4">NeuroSphere</h1>
    <div id="chatHistory" class="space-y-2"></div>
  </div>

  <!-- Основной чат -->
  <div class="flex-1 flex flex-col">
    <div class="flex-1 p-4 overflow-y-auto" id="chat"></div>
    <div class="p-4 border-t">
      <input 
        id="messageInput" 
        placeholder="Введите сообщение..." 
        class="w-full p-2 border rounded"
      >
      <button id="sendButton" class="mt-2 bg-blue-600 text-white py-2 px-4 rounded">
        Отправить
      </button>
    </div>
  </div>

  <script>
    const userId = 'user_' + Math.random().toString(36).substring(2, 9); // Генерируем ID пользователя

    // Загружаем историю чатов
    async function loadHistory() {
      const response = await fetch(`https://neurosphere-08pk.onrender.com/api/chats/${userId}`);
      const chats = await response.json();
      const historyDiv = document.getElementById('chatHistory');
      
      chats.forEach(chat => {
        historyDiv.innerHTML += `
          <div class="p-2 hover:bg-gray-700 rounded cursor-pointer">
            ${chat.message.substring(0, 20)}...
          </div>
        `;
      });
    }

    // Отправка сообщения
    document.getElementById('sendButton').addEventListener('click', async () => {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      if (!message) return;

      const response = await fetch('https://neurosphere-08pk.onrender.com/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message, user_id: userId })
      });
      const data = await response.json();

      // Обновляем интерфейс
      document.getElementById('chat').innerHTML += `
        <div class="mb-4 text-right"><p class="bg-blue-500 text-white inline-block p-2 rounded">${message}</p></div>
        <div class="mb-4"><p class="bg-gray-200 inline-block p-2 rounded">${data.reply}</p></div>
      `;
      input.value = '';
      loadHistory(); // Перезагружаем историю
    });

    loadHistory(); // Первая загрузка истории
  </script>
</body>
</html>
